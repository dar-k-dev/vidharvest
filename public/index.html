<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VidHarvest Pro - Your AI Video Assistant</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="ChatGPT-style video downloader supporting YouTube, TikTok, Instagram, and 50+ platforms">
    <meta name="theme-color" content="#0F7B7C">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="VidHarvest Pro">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#0F7B7C">
    <meta name="msapplication-config" content="/browserconfig.xml">
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
    <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#0F7B7C">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/css/styles.css">
    
    <!-- Socket.IO -->
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <!-- Header Bar -->
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <div class="logo">
                    <div class="logo-icon">
                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                            <circle cx="16" cy="16" r="16" fill="#0F7B7C"/>
                            <path d="M12 10l8 6-8 6V10z" fill="white"/>
                            <circle cx="24" cy="8" r="3" fill="#20B2AA"/>
                        </svg>
                    </div>
                    <span class="logo-text">VidHarvest Pro</span>
                </div>
            </div>
            
            <div class="header-center">
                <h1 class="header-title">Video Download Assistant</h1>
                <span class="header-status" id="headerStatus">Ready</span>
            </div>
            
            <div class="header-right">
                <button class="header-btn" id="historyBtn" title="Chat History">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 3h18v18H3zM9 9h6m-6 4h6"/>
                    </svg>
                    <span class="badge" id="historyBadge">0</span>
                </button>
                
                <button class="header-btn" id="settingsBtn" title="Settings">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                </button>
                
                <button class="header-btn" id="themeToggle" title="Toggle Theme">
                    <svg class="theme-icon sun" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                    </svg>
                    <svg class="theme-icon moon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                </button>
                
                <button class="header-btn" id="newChatBtn" title="New Chat">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14m-7-7h14"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Chat Interface -->
    <main class="chat-container">
        <div class="chat-messages" id="chatMessages">
            <!-- Welcome message will be inserted here -->
        </div>
    </main>

    <!-- Chat Input Area -->
    <div class="chat-input-container">
        <div class="chat-input-wrapper">
            <textarea 
                class="chat-input" 
                id="chatInput" 
                placeholder="Paste video URL here (YouTube, TikTok, Instagram...)"
                rows="1"
            ></textarea>
            
            <button class="paste-btn" id="pasteBtn" title="Paste from clipboard">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
                    <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
                </svg>
            </button>
            
            <button class="send-btn" id="sendBtn" title="Send message">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="historyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Chat History</h2>
                <button class="modal-close" id="closeHistoryModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-actions" style="margin-bottom: 16px; text-align: right;">
                    <button class="control-btn" onclick="app.clearChatHistory()" style="color: #ef4444; border-color: #ef4444;">Clear All</button>
                </div>
                <div id="historyList">
                    <!-- History items will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="modal-close" id="closeSettingsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-tabs">
                    <button class="settings-tab active" data-tab="general">🎯 General</button>
                    <button class="settings-tab" data-tab="enhancement">✨ Enhancement</button>
                    <button class="settings-tab" data-tab="legal">📋 Legal</button>
                </div>
                
                <div class="settings-content">
                    <div class="settings-panel active" id="general-panel">
                        <div class="settings-card">
                            <div class="settings-card-header">
                                <h3>🎯 Download Preferences</h3>
                                <p>Configure your default download settings</p>
                            </div>
                            <div class="settings-card-body">
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label>Default Quality</label>
                                        <span class="setting-desc">Choose the default video quality for downloads</span>
                                    </div>
                                    <select id="defaultQuality" class="setting-select">
                                        <option value="best">Best Available</option>
                                        <option value="1080p">1080p HD</option>
                                        <option value="720p">720p HD</option>
                                        <option value="480p">480p</option>
                                    </select>
                                </div>
                                
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label>File Management</label>
                                        <span class="setting-desc">Files are automatically deleted after download</span>
                                    </div>
                                    <div class="setting-status">
                                        <span class="status-badge">Auto-cleanup enabled</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-panel" id="enhancement-panel">
                        <div class="settings-card">
                            <div class="settings-card-header">
                                <h3>✨ AI Enhancement Options</h3>
                                <p>Automatically improve video quality using AI</p>
                            </div>
                            <div class="settings-card-body">
                                <div class="enhancement-options">
                                    <div class="enhancement-item">
                                        <div class="enhancement-info">
                                            <div class="enhancement-icon">🔍</div>
                                            <div class="enhancement-details">
                                                <h4>AI Upscaling</h4>
                                                <p>Increase video resolution using machine learning</p>
                                            </div>
                                        </div>
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="autoUpscale">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                    
                                    <div class="enhancement-item">
                                        <div class="enhancement-info">
                                            <div class="enhancement-icon">🎧</div>
                                            <div class="enhancement-details">
                                                <h4>Noise Reduction</h4>
                                                <p>Remove background noise and audio artifacts</p>
                                            </div>
                                        </div>
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="autoNoise">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                    
                                    <div class="enhancement-item">
                                        <div class="enhancement-info">
                                            <div class="enhancement-icon">🎨</div>
                                            <div class="enhancement-details">
                                                <h4>Color Correction</h4>
                                                <p>Auto-adjust brightness, contrast, and colors</p>
                                            </div>
                                        </div>
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="autoColor">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-panel" id="legal-panel">
                        <div class="settings-card">
                            <div class="settings-card-header">
                                <h3>📋 Legal & Privacy Information</h3>
                                <p>Important documents and policies</p>
                            </div>
                            <div class="settings-card-body">
                                <div class="legal-links">
                                    <a href="/privacy.html" target="_blank" class="legal-link">
                                        <div class="legal-icon">🔒</div>
                                        <div class="legal-info">
                                            <h4>Privacy Policy</h4>
                                            <p>How we handle your data and privacy</p>
                                        </div>
                                        <div class="legal-arrow">→</div>
                                    </a>
                                    
                                    <a href="/terms.html" target="_blank" class="legal-link">
                                        <div class="legal-icon">📄</div>
                                        <div class="legal-info">
                                            <h4>Terms of Service</h4>
                                            <p>Rules and guidelines for using VidHarvest Pro</p>
                                        </div>
                                        <div class="legal-arrow">→</div>
                                    </a>
                                    
                                    <a href="/ai-data.html" target="_blank" class="legal-link">
                                        <div class="legal-icon">🤖</div>
                                        <div class="legal-info">
                                            <h4>AI Data Processing</h4>
                                            <p>How our AI processes your messages</p>
                                        </div>
                                        <div class="legal-arrow">→</div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-footer">
                    <button class="btn btn-secondary" onclick="app.hideSettingsModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="app.saveSettings()">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <p>Analyzing video...</p>
    </div>

    <!-- PWA Install Prompt -->
    <div id="installPrompt" class="install-prompt" style="display: none;">
        <div class="install-content">
            <div class="install-icon">📱</div>
            <div class="install-text">
                <h3>Install VidHarvest Pro</h3>
                <p>Get the full app experience with offline support</p>
            </div>
            <div class="install-actions">
                <button id="installBtn" class="btn btn-primary">Install</button>
                <button id="dismissInstall" class="btn btn-secondary">Later</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // PWA Install Prompt
        let deferredPrompt;
        const installPrompt = document.getElementById('installPrompt');
        const installBtn = document.getElementById('installBtn');
        const dismissBtn = document.getElementById('dismissInstall');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installPrompt.style.display = 'block';
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log('Install outcome:', outcome);
                deferredPrompt = null;
            }
            installPrompt.style.display = 'none';
        });

        dismissBtn.addEventListener('click', () => {
            installPrompt.style.display = 'none';
        });

        // Register service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(reg => console.log('SW registered:', reg))
                .catch(err => console.log('SW registration failed:', err));
        }
    </script>
    <script src="/js/app.js"></script>
    <script src="/js/chat.js"></script>
    <script src="/js/download.js"></script>
    <script src="/js/pwa.js"></script>
</body>
</html>